{% extends "base.html" %}
{% block title %}Chat Room{% endblock %}
{% block content %}
<div id="chat">
</div>
<div id="chat-input">
    <input type="text" id="chat-message-input" placeholder="Type your message here...">
    <input type="submit" id="chat-message-submit" value="Send">
</div>
{% endblock %}
{% block include_js %}
    {{ user.id | json_script:"user-id"}}
{% endblock %}
{% block domready %}
    const userId = JSON.parse(
        document.getElementById('user-id').textContent
    );
    const url = 'ws://' + window.location.host + 
                '/ws/chat/room' + userId + '/';
    const chatSocket = new WebSocket(url);
    chatSocket.onmessage = function(event){
        const data = JSON.parse(event.data);
        const chat = document.getElementById('chat');
        chat.innerHTML += '<div class="message">' + data.message + '</div>';
        chat.scrollTop = chat.scrollHeight;
    };
    chatSocket.onclose = function(event) {
        console.error('Chat socket closed unexpectedly');
    };
{% endblock %}